<style>
    .welcome .layui-card {border:1px solid #f2f2f2;border-radius:5px;}
    .welcome .icon {margin-right:10px;color:#1aa094;}
    .welcome .icon-cray {color:#ffb800 !important;}
    .welcome .icon-blue {color:#1e9fff !important;}
    .welcome .icon-tip {color:#ff5722 !important;}
    .welcome .layuimini-qiuck-module {text-align:center;margin-top:10px}
    .welcome .layuimini-qiuck-module a i {display:inline-block;width:100%;height:60px;line-height:60px;text-align:center;border-radius:2px;font-size:30px;background-color:#F8F8F8;color:#333;transition:all .3s;-webkit-transition:all .3s;}
    .welcome .layuimini-qiuck-module a cite {position:relative;top:2px;display:block;color:#666;text-overflow:ellipsis;overflow:hidden;white-space:nowrap;font-size:14px;}
    .welcome .welcome-module {width:100%;height:210px;}
    .welcome .panel {background-color:#fff;border:1px solid transparent;border-radius:3px;-webkit-box-shadow:0 1px 1px rgba(0,0,0,.05);box-shadow:0 1px 1px rgba(0,0,0,.05)}
    .welcome .panel-body {padding:10px}
    .welcome .panel-title {margin-top:0;margin-bottom:0;font-size:12px;color:inherit}
    .welcome .label {display:inline;padding:.2em .6em .3em;font-size:75%;font-weight:700;line-height:1;color:#fff;text-align:center;white-space:nowrap;vertical-align:baseline;border-radius:.25em;margin-top:.3em;}
    .welcome .layui-red {color:red}
    .welcome .main_btn > p {height:40px;}
    .welcome .layui-bg-number {background-color:#F8F8F8;}
    .welcome .layuimini-notice:hover {background:#f6f6f6;}
    .welcome .layuimini-notice {padding:7px 16px;clear:both;font-size:12px !important;cursor:pointer;position:relative;transition:background 0.2s ease-in-out;}
    .welcome .layuimini-notice-title,.layuimini-notice-label {padding-right:70px !important;text-overflow:ellipsis !important;overflow:hidden !important;white-space:nowrap !important;}
    .welcome .layuimini-notice-title {line-height:28px;font-size:14px;}
    .welcome .layuimini-notice-extra {position:absolute;top:50%;margin-top:-8px;right:16px;display:inline-block;height:16px;color:#999;}
</style>

<div class="layuimini-container layuimini-page-anim">
    <div class="layuimini-main welcome">
        <fieldset class="layui-elem-field layui-field-title" style="margin-top: 20px;">
            <legend>年度信息检索</legend>
            <div style="margin: 10px 10px 10px 10px">
<!--                <form class="layui-form layui-form-pane" action="">-->
                    <div class="layui-form-item">
                        <div class="layui-inline">
                            <label class="layui-form-label">年份</label>
                            <div class="layui-input-inline">
                                <input type="text" id="year" name="year" autocomplete="off" class="layui-input">
                            </div>
                        </div>
                        <div class="layui-inline">
<!--                            <button id="search" type="submit" class="layui-btn layui-btn-primary"  lay-submit lay-filter="data-search-btn">-->
                            <button id="search" type="button" class="layui-btn layui-btn-primary" onclick="initPage()">
                                <i class="layui-icon"></i> 搜 索
                            </button>
                        </div>
                    </div>
<!--                </form>-->
            </div>
        </fieldset>


        <div class="layui-row layui-col-space15">

            <!--小格子信息展示-->
            <div class="layui-col-md8">
                <div class="layui-row layui-col-space15">
                    <!--年度数据统计-->
                    <div class="layui-col-md6">
                        <div class="layui-card">
                            <div class="layui-card-header" style="font-size: 18px">
                                <i class="fa fa-warning icon"></i>
                                年度数据统计
                            </div>
                            <!--小卡片设置-->
                            <div class="layui-card-body">
                                <div class="welcome-module">
                                    <div class="layui-row layui-col-space10">
                                        <!--项目-->
                                        <div class="layui-col-xs6">
                                            <div class="panel layui-bg-number">
                                                <div class="panel-body">
                                                    <div class="panel-title">
                                                        <span class="label pull-right layui-bg-blue">年度</span>
                                                        <h5 style="font-size: 16px">项目数量</h5>
                                                    </div>
                                                    <div class="panel-content">
                                                        <h1 id="projectNum" class="no-margins"></h1>
                                                        <small>年度总记录数</small>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <!--实施-->
                                        <div class="layui-col-xs6">
                                            <div class="panel layui-bg-number">
                                                <div class="panel-body">
                                                    <div class="panel-title">
                                                        <span class="label pull-right layui-bg-cyan">年度</span>
                                                        <h5 style="font-size: 16px">实施统计</h5>
                                                    </div>
                                                    <div class="panel-content">
                                                        <h1 id="executeNum" class="no-margins"></h1>
                                                        <small>年度总记录数</small>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <!--会议-->
                                        <div class="layui-col-xs6">
                                            <div class="panel layui-bg-number">
                                                <div class="panel-body">
                                                    <div class="panel-title">
                                                        <span class="label pull-right layui-bg-orange">年度</span>
                                                        <h5 style="font-size: 16px">会议统计</h5>
                                                    </div>
                                                    <div class="panel-content">
                                                        <h1 id="meetingNum" class="no-margins"></h1>
                                                        <small>年度总记录数</small>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <!--培训-->
                                        <div class="layui-col-xs6">
                                            <div class="panel layui-bg-number">
                                                <div class="panel-body">
                                                    <div class="panel-title">
                                                        <span class="label pull-right layui-bg-green">年度</span>
                                                        <h5 style="font-size: 16px">培训统计</h5>
                                                    </div>
                                                    <div class="panel-content">
                                                        <h1 id="trainNum" class="no-margins"></h1>
                                                        <small>年度总记录数</small>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>


                    <!--年度数据汇算-->
                    <div class="layui-col-md6">
                        <div class="layui-card">
                            <div class="layui-card-header" style="font-size: 18px">
                                <i class="fa fa-warning icon"></i>
                                年度数据汇算
                            </div>
                            <!--小卡片设置-->
                            <div class="layui-card-body">
                                <div class="welcome-module">
                                    <div class="layui-row layui-col-space10">
                                        <!--周期最长的项目-->
<!--                                        <div class="layui-col-xs6">-->
<!--                                            <div class="panel layui-bg-number">-->
<!--                                                <div class="panel-body">-->
<!--                                                    <div class="panel-title">-->
<!--                                                        <span class="label pull-right layui-bg-blue">年度</span>-->
<!--                                                        <h5 style="font-size: 16px">周期最长的项目</h5>-->
<!--                                                    </div>-->
<!--                                                    <div class="panel-content">-->
<!--                                                        <h1 class="no-margins"></h1>-->
<!--                                                        <small>年度汇算</small>-->
<!--                                                    </div>-->
<!--                                                </div>-->
<!--                                            </div>-->
<!--                                        </div>-->
                                        <!--实施最多的月份-->
                                        <div class="layui-col-xs6">
                                            <div class="panel layui-bg-number">
                                                <div class="panel-body">
                                                    <div class="panel-title">
                                                        <span class="label pull-right layui-bg-cyan">年度</span>
                                                        <h5 style="font-size: 16px">实施最多的月份</h5>
                                                    </div>
                                                    <div class="panel-content">
                                                        <h1 id="exeMostMonth" class="no-margins"></h1>
                                                        <small>年度汇算</small>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!--图标展示-->
            <div class="layui-col-md12">
                <div class="layui-card">
                    <div class="layui-card-header" style="font-size: 18px">
                        <i class="fa fa-line-chart icon"></i>报表统计
                    </div>
                    <!--一年中各种事件的直接统计-->
                    <div class="layui-card-body">
                        <div id="events-records" style="width: 100%;min-height:500px"></div>
                    </div>
                    <!--一年中每个人做的实施的统计-->
                    <div class="layui-card-body">
                        <div id="person-events-records" style="width: 100%;min-height:500px"></div>
                    </div>
                </div>
            </div>
        </div>


    </div>
</div>

<script type="text/javascript">
    //在加载页面的时候，查询当前年度信息
    // var $ = layui.jquery
    // //获取当前年份
    // var yearInPage = $("#year").text();
    // console.log("获取到的页面上的年份：" + yearInPage);
    // var date = new Date();
    // var currentYear = "";
    // if (isEmpty(yearInPage)){ //如果是空的
    //     currentYear = date.getFullYear(); var currentMonth = date.getMonth() + 1;
    //     console.log("当前年：" + currentYear + " 月："+ currentMonth);
    //     initPage(currentYear);
    // }else{
    //     currentYear = yearInPage;
    // }
    // $('#year').val(currentYear);
    // $('#year').text(currentYear);

    initPage();
    function initPage() {
        layui.use(['jquery','echarts'], function() {
            var $ = layui.jquery, echarts = layui.echarts;

            var currentYear = "";
            var date = new Date();
            console.log("页面上获取的年份：" + $("#year").val());
            if (isEmpty($("#year").val())){
                currentYear = date.getFullYear(); var currentMonth = date.getMonth() + 1;
                console.log("当前年：" + currentYear + " 月："+ currentMonth);
            }else{
                currentYear = $("#year").val();
            }
            $('#year').val(currentYear);
            $('#year').text(currentYear);


            $.ajax({
                url: 'GetAnnualInfo',
                type: 'post',
                //dataType: 'text', //可以不写
                //contentType: 'html/text',
                data: {'year':currentYear},
                success: function (data) {  //data 返回值
                    console.log(data);
                    $('#projectNum').text(data.projectNum);
                    $('#executeNum').text(data.executeNum);
                    $('#meetingNum').text(data.meetingNum);
                    $('#trainNum').text(data.trainNum);
                    $('#exeMostMonth').text(data.exeMostMonth);

                    var month_executeCount = new Array();
                    var month_meetingCount = new Array();
                    var month_trainCount = new Array();
                    for (var i=0; i<data.monthInfoList.length; i++){
                        month_executeCount[i] = data.monthInfoList[i].executeCount;
                        month_meetingCount[i] = data.monthInfoList[i].meetingCount;
                        month_trainCount[i] = data.monthInfoList[i].trainCount;
                    }
                    console.log(data.monthInfoList);
                    console.log(month_executeCount);
                    console.log(month_meetingCount);
                    console.log(month_trainCount);

                    //渲染曲线图
                    /**
                     * 年度事件的直接统计
                     */
                    var echartsRecords = echarts.init(document.getElementById('events-records'), 'walden');
                    var optionRecords = {
                        tooltip: {
                            trigger: 'axis'
                        },
                        legend: {
                            data: ['月度实施数量', '月度会议数量', '月度培训数量']
                        },
                        grid: {
                            left: '3%',
                            right: '4%',
                            bottom: '3%',
                            containLabel: true
                        },
                        toolbox: {
                            feature: {
                                saveAsImage: {}
                            }
                        },
                        xAxis: {
                            type: 'category',
                            boundaryGap: false,
                            data: ['一月', '二月', '三月', '四月', '五月', '六月', '七月', '八月', '九月', '十月', '十一月', '十二月']
                        },
                        yAxis: {
                            type: 'value'
                        },
                        series: [
                            {
                                name: '月度实施数量',
                                type: 'line',
                                //data: [120, 132, 101, 134, 90, 230, 210]
                                data: month_executeCount
                            },
                            {
                                name: '月度会议数量',
                                type: 'line',
                                //data: [220, 182, 191, 234, 290, 330, 310]
                                data: month_meetingCount
                            },
                            {
                                name: '月度培训数量',
                                type: 'line',
                                //data: [150, 232, 201, 154, 190, 330, 410]
                                data: month_trainCount
                            }
                        ]
                    };
                    echartsRecords.setOption(optionRecords);

                    /**
                     * 年度个人实施的数据统计
                     */
                    var echartsRecords = echarts.init(document.getElementById('person-events-records'), 'walden');
                    var optionRecords = {
                        tooltip: {
                            trigger: 'axis'
                        },
                        legend: {
                            data: data.nameArray
                        },
                        grid: {
                            left: '3%',
                            right: '4%',
                            bottom: '3%',
                            containLabel: true
                        },
                        toolbox: {
                            feature: {
                                saveAsImage: {}
                            }
                        },
                        xAxis: {
                            type: 'category',
                            boundaryGap: false,
                            data: ['一月', '二月', '三月', '四月', '五月', '六月', '七月', '八月', '九月', '十月', '十一月', '十二月']
                        },
                        yAxis: {
                            type: 'value'
                        },
                        series: data.personExecuteMonthInfo

                    };
                    echartsRecords.setOption(optionRecords);
                },
                error: function (data) {
                    alert("数据获取异常");
                }
            });

        })
    }

    //判断是否为空串、未定义、null
    function isEmpty(strIn) {
        if (strIn === undefined) {
            return true;
        } else if (strIn == null) {
            return true;
        } else if (strIn == "") {
            return true;
        } else {
            return false;
        }
    }
</script>